<?xml version="1.0" encoding="UTF-8"?>
<database defaultIdMethod="native" name="default" tablePrefix="defender_">
	<behavior name="auto_add_pk" />

	<!-- Bible tables -->
	<table name="bible">
		<column name="code" required="true" size="255" type="varchar" />
		<column name="name" required="true" size="255" type="varchar" />
	</table>
	<table name="book">
		<column name="chapter_count" required="true" type="integer" />
		<column name="name" required="true" size="255" type="varchar" />
	</table>
	<table name="verse">
		<column name="bible_id" required="true" type="integer" />
		<column name="book_id" required="true" type="integer" />
		<column name="chapter_number" required="true" type="integer" />
		<column name="text" required="true" size="1000" type="varchar" />
		<column name="verse_number" required="true" type="integer" />
		<column name="word_count" required="true" type="integer" />
		<foreign-key foreignTable="bible">
			<reference foreign="id" local="bible_id" />
		</foreign-key>
		<foreign-key foreignTable="book">
			<reference foreign="id" local="book_id" />
		</foreign-key>
	</table>

	<!-- Tagging tables -->
	<table name="tag">
		<behavior id="vote_count_aggregate" name="aggregate_column">
			<parameter name="name" value="vote_count" />
			<parameter name="foreign_table" value="tag_vote" />
			<parameter name="expression" value="COUNT(tag_id)" />
		</behavior>
		<column name="relevant_words" required="true" size="255" type="varchar" />
		<column name="topic_id" required="true" type="integer" />
		<column name="verse_id" required="true" type="integer" />
		<column defaultValue="0" name="vote_count" type="integer" />
		<foreign-key foreignTable="topic">
			<reference foreign="id" local="topic_id" />
		</foreign-key>
		<foreign-key foreignTable="verse">
			<reference foreign="id" local="verse_id" />
		</foreign-key>
	</table>
	<table name="tag_vote">
		<column name="tag_id" required="true" type="integer" />
		<foreign-key foreignTable="tag">
			<reference foreign="id" local="tag_id" />
		</foreign-key>
	</table>

	<!-- Topic tables -->
	<table name="topic">
		<behavior id="tag_count_aggregate" name="aggregate_column">
			<parameter name="name" value="tag_count" />
			<parameter name="foreign_table" value="tag" />
			<parameter name="expression" value="COUNT(topic_id)" />
		</behavior>
		<column defaultValue="0" name="is_root" required="true" type="boolean" />
		<column name="name" required="true" size="255" type="varchar" />
		<column defaultValue="0" name="tag_count" required="true" type="integer" />
	</table>
	<table name="topic_link">
		<column name="link_id" required="true" type="integer" />
		<column name="strength" required="true" type="integer" />
		<column name="topic_id" required="true" type="integer" />
		<foreign-key foreignTable="topic" onDelete="cascade">
			<reference foreign="id" local="topic_id" />
		</foreign-key>
	</table>
	<table name="topic_parent">
		<column name="parent_id" required="true" type="integer" />
		<column name="topic_id" required="true" type="integer" />
		<foreign-key foreignTable="topic" onDelete="cascade">
			<reference foreign="id" local="topic_id" />
		</foreign-key>
	</table>
	<table name="topic_synonym">
		<column name="name" required="true" size="255" type="varchar" />
		<column name="topic_id" required="true" type="integer" />
		<foreign-key foreignTable="topic" onDelete="cascade">
			<reference foreign="id" local="topic_id" />
		</foreign-key>
	</table>

	<!-- Argument tables -->
	<table name="answer">
		<column name="answer_type_id" required="true" type="integer" />
		<column name="response_id" required="true" type="integer" />
		<column name="text" required="true" size="255" type="varchar" />
		<foreign-key foreignTable="answer_type">
			<reference foreign="id" local="answer_type_id" />
		</foreign-key>
		<foreign-key foreignTable="response">
			<reference foreign="id" local="response_id" />
		</foreign-key>
	</table>
	<table name="answer_type">
		<column name="value" required="true" size="255" type="varchar" />
	</table>
	<table name="response">
		<column name="explanation" size="255" type="varchar" />
		<column name="text" required="true" size="255" type="varchar" />
	</table>
	<table name="statement">
		<column name="response_id" required="true" type="integer" />
		<column name="text" required="true" size="255" type="varchar" />
		<foreign-key foreignTable="response">
			<reference foreign="id" local="response_id" />
		</foreign-key>
	</table>

</database>